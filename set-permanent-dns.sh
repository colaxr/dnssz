#!/bin/bash
# ä¸€é”®é€‰æ‹©å¹¶æ°¸ä¹…è®¾ç½® DNSï¼ˆæ”¯æŒ IPv4 / IPv6 / è‡ªå®šä¹‰ï¼‰
# é€‚ç”¨äºŽ Debian / Ubuntu ç³»ç»Ÿ

CONFIG_FILE="/etc/systemd/resolved.conf"
RESOLV_FILE="/etc/resolv.conf"

echo "====================================="
echo "ðŸ›°  DNS è®¾ç½®å·¥å…·ï¼ˆæ”¯æŒ IPv4 / IPv6 / è‡ªå®šä¹‰ï¼‰"
echo "====================================="
echo "1ï¸âƒ£ ä½¿ç”¨ IPv4: 8.8.8.8 (Google)"
echo "2ï¸âƒ£ ä½¿ç”¨ IPv4: 1.1.1.1 (Cloudflare)"
echo "3ï¸âƒ£ ä½¿ç”¨ IPv6: 2001:4860:4860::8888 (Google)"
echo "4ï¸âƒ£ ä½¿ç”¨ IPv6: 2606:4700:4700::1111 (Cloudflare)"
echo "5ï¸âƒ£ ä½¿ç”¨åŒæ ˆ: 8.8.8.8 + 2001:4860:4860::8888 (Google)"
echo "6ï¸âƒ£ ä½¿ç”¨åŒæ ˆ: 1.1.1.1 + 2606:4700:4700::1111 (Cloudflare)"
echo "7ï¸âƒ£ ä½¿ç”¨å®Œæ•´åŒæ ˆ: 1.1.1.1 + 8.8.8.8 + 2606:4700:4700::1111 + 2001:4860:4860::8888"
echo "8ï¸âƒ£ ä½¿ç”¨å®Œæ•´åŒæ ˆï¼ˆåå‘é¡ºåºï¼‰: 8.8.8.8 + 1.1.1.1 + 2001:4860:4860::8888 + 2606:4700:4700::1111"
echo "9ï¸âƒ£ ðŸ§© è‡ªå®šä¹‰è¾“å…¥ï¼ˆå¯è‡ªç”±ç»„åˆ IPv4 / IPv6ï¼‰"
echo "-------------------------------------"
read -p "è¯·è¾“å…¥é€‰é¡¹ (1-9): " choice

case $choice in
  1)
    DNS="8.8.8.8"
    ;;
  2)
    DNS="1.1.1.1"
    ;;
  3)
    DNS="2001:4860:4860::8888"
    ;;
  4)
    DNS="2606:4700:4700::1111"
    ;;
  5)
    DNS="8.8.8.8 2001:4860:4860::8888"
    ;;
  6)
    DNS="1.1.1.1 2606:4700:4700::1111"
    ;;
  7)
    DNS="1.1.1.1 8.8.8.8 2606:4700:4700::1111 2001:4860:4860::8888"
    ;;
  8)
    DNS="8.8.8.8 1.1.1.1 2001:4860:4860::8888 2606:4700:4700::1111"
    ;;
  9)
    echo "è¯·è¾“å…¥è‡ªå®šä¹‰ DNSï¼ˆå¯ç©ºæ ¼åˆ†éš”å¤šä¸ª IPv4 / IPv6 åœ°å€ï¼‰ï¼š"
    echo "ç¤ºä¾‹: 1.1.1.1 8.8.8.8 2606:4700:4700::1111 2001:4860:4860::8888"
    read -p "è¯·è¾“å…¥: " DNS
    ;;
  *)
    echo "âŒ æ— æ•ˆè¾“å…¥ï¼Œé€€å‡ºã€‚"
    exit 1
    ;;
esac

echo "ðŸ”§ æ­£åœ¨è®¾ç½® DNS ä¸º: $DNS"

# ç¦ç”¨ systemd-resolved é˜²æ­¢è‡ªåŠ¨è¦†ç›–
if systemctl list-units | grep -q systemd-resolved.service; then
  sudo systemctl stop systemd-resolved.service
  sudo systemctl disable systemd-resolved.service
fi

# å¤‡ä»½æ—§é…ç½®
sudo cp -f /etc/resolv.conf /etc/resolv.conf.bak 2>/dev/null

# å†™å…¥æ–°çš„ DNS è®¾ç½®
sudo bash -c "cat > /etc/resolv.conf <<EOF
# è‡ªå®šä¹‰DNSè®¾ç½®
$(for i in $DNS; do echo "nameserver $i"; done)
EOF"

# é”å®šæ–‡ä»¶é˜²æ­¢è¢«è¦†ç›–
sudo chattr +i /etc/resolv.conf

echo "âœ… DNS å·²ä¿®æ”¹å¹¶é”å®šã€‚"
echo "ðŸ§© å½“å‰ DNS è®¾ç½®å¦‚ä¸‹ï¼š"
cat /etc/resolv.conf
echo "-------------------------------------"
echo "å¦‚éœ€ä¿®æ”¹ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è§£é”:"
echo "sudo chattr -i /etc/resolv.conf"
echo "ç„¶åŽé‡æ–°è¿è¡Œæœ¬è„šæœ¬ã€‚"
echo "-------------------------------------"
